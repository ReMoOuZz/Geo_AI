<%
    game = @score.game
    total_questions = game.game_questions.count
    correct_answers = @score.value
    percentage = total_questions > 0 ? (correct_answers.to_f / total_questions * 100).round : 0
    incorrect_questions = game.game_questions.joins(:user_answers)
        .where(user_answers: { user: current_user, is_correct: false })
%>

<div class="score-container" 
     data-controller="score-results" 
     data-score-results-percentage-value="<%= percentage %>" 
     data-score-results-correct-value="<%= correct_answers %>" 
     data-score-results-total-value="<%= total_questions %>">
        
    <!-- Container 1: Trophée + Message + Pourcentage -->
    <div class="score-wrapper">
        <div class="score-summary">
            <div class="trophy" data-score-results-target="trophy">
            </div>
            <h1 data-score-results-target="message">
            </h1>
            <div class="score-display">
                <span class="score-text" data-score-results-target="scoreText"><%= percentage %>%</span>
                <div class="score-label">Score final</div>
            </div>
            <p>Badges obtenus </p>
        <div class="action-buttons">
            <%= link_to "Recommencer", new_game_path, class: "btn" %>
            <%= link_to "Menu principal", root_path, class: "btn" %>
        </div>
    </div>
</div>
    
    <!-- Container 2: Stats + Détails -->
    <div class="score-details-container">
        <!-- Catégories -->
        <div class="category-info">
            <div class="category-tags">
                <% if game.category.present? %>
                    <span><%= game.category.capitalize %></span>
                <% end %>
                <% if game.difficulty.present? %>
                    <span><%= game.difficulty.capitalize %></span>
                <% end %>
                <% if game.region.present? %>
                    <span><%= game.region.capitalize %></span>
                <% end %>
            </div>
        </div>
                
        <!-- Stats des réponses -->
        <div class="score-stats">
            <div class="stat-item">
                <span class="stat-label">Bonnes réponses</span>
                <span class="stat-value" data-score-results-target="correctCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Mauvaises réponses</span>
                <span class="stat-value" data-score-results-target="incorrectCount">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total questions</span>
                <span class="stat-value" data-score-results-target="totalCount">0</span>
            </div>
        </div>
                
        <!-- Questions incorrectes -->
        <% if incorrect_questions.any? %>
            <div class="incorrect-questions">
                <h3>Questions ratées</h3>
                <div class="questions-list">
                    <% incorrect_questions.each do |question| %>
                        <div class="question-item">
                            <div class="question-text">
                                <i class="fa-solid fa-circle-question" style="color: #FF0000"></i> <%= question.content %>
                            </div>
                            <div class="correct-answer">
                                <i class="fa-solid fa-circle-check" style="color: #63E6BE;"></i> <%= question.correct_answer %>
                            </div>
                            <% if question.contexte.present? %>
                                <div class="question-context">
                                    <i class="fa-solid fa-lightbulb" style="color: #FFD43B;"></i> <%= question.contexte %>
                                </div>
                            <% end %>
                        </div>
                    <% end %>
                </div>
            </div>
        <% else %>
            <div class="perfect-score">
                Aucune erreur ! Parfait !
            </div>
        <% end %>
                
        <!-- Message personnalisé -->
        <div class="feedback-message">
            <div class="feedback-text" data-score-results-target="advice">
            </div>
        </div>
    </div>
</div>


